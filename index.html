<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MongoDB Sync Manager</title>
    <script>
        async function startSync(port) {
            const response = await fetch(`/start_sync/${port}`, { method: "POST" });
            const result = await response.json();
            alert(result.message);
        }

        async function stopSync(port) {
            const response = await fetch(`/stop_sync/${port}`, { method: "POST" });
            const result = await response.json();
            alert(result.message);
        }

        async function checkProgress(port) {
            const response = await fetch(`/sync_status/${port}`);
            const status = await response.json();
            document.getElementById(`progress-${port}`).innerText = JSON.stringify(status.progress, null, 2);
            document.getElementById(`status-${port}`).innerText = status.status;
        }

        function autoRefreshProgress(port) {
            setInterval(() => checkProgress(port), 5000);
        }
    </script>
</head>
<body>
    <h1>MongoDB Sync Manager</h1>
    {% for port in instance_ports %}
    <div style="margin-bottom: 20px;">
        <h2>Instance on Port {{ port }}</h2>
        <button onclick="startSync({{ port }})">Start Sync</button>
        <button onclick="stopSync({{ port }})">Stop Sync</button>
        <button onclick="checkProgress({{ port }})">Refresh Progress</button>
        <p>Status: <span id="status-{{ port }}">idle</span></p>
        <h3>Progress</h3>
        <pre id="progress-{{ port }}">No status available</pre>
        <script>autoRefreshProgress({{ port }});</script>
    </div>
    {% endfor %}
</body>
</html>
